# 记录

本文档为项目的记录文档

## 项目启动

本项目旨在使用SFT+GRPO训练一个LLM，帮助“原素方程”品牌构建一个品牌专属的、能够自动化生成高质量营销文案的AI助手。侧重于社交媒体笔记文案、电商描述文案和付费广告文案。

### 原素方程 品牌风格指南
- 品牌理念: 

精简有效，回归肌肤本源。我们专注于科学配方，摒弃不必要的成分堆砌。

- 品牌人格: 

一位冷静、专业、值得信赖的皮肤科医生或科研人员。

- 沟通要点:

专业严谨: 用词准确，逻辑清晰，像在做一次小科普。

冷静客观: 专注于解决方案，不贩卖焦虑，避免使用夸张的感叹句。

透明真诚: 清晰解释核心成分与功效，不使用模糊、神秘的词汇。

- 关键词选用:

鼓励使用: 屏障, 修护, 科学, 精简, 配方, 浓度, 源头, 温和。

坚决避免: 神器, 逆天, 奇迹, 秒杀, 绝绝子, yyds, 家人们。

## 大致思路

对给定产品列表，划分训练集、验证集；使用DeepSeek-V3构造特定方向文案，多轮清洗直到符合要求；混合使用多种策略构造Reward Model需要的rejected数据；使用LLM as a Judge来评测模型效果。用各种训练集来

## 过程记录

1. 前期准备&首次生成：对于给定的产品列表，划分训练集、验证集，每种产品分别构造3大类文案，分为9小类。使用的脚本为`dataset_generate/generate_sft_datasets.py`，使用的prompts位于`sft_gen_prompts.py`。生成`data/sft_dataset_deepseek.jsonl`和`data/val_dataset_deepseek.jsonl`(2025.8.20)
2. 数据清洗：对于首次生成的数据集，存在问题：1. 有不知道为什么会加进去的标签 2. 有的社交媒体笔记过于平淡，缺少人设真实感和故事感。针对这两点进行优化，使用`dataset_generate/sft_clean_prompts.py`的prompt和`dataset_generate/clean_sft_datasets.py`脚本，对数据进行优化，产物为`sft_dataset_cleaned.jsonl`。(2025.8.22)后续又发现部分广告文案缺少最后的号召部分，又使用`dataset_generate/clean_sft_datasets_cta.py`脚本和`dataset_generate/sft_clean_prompts_cta.py`的prompt进行清洗，添加CTA部分，产物为`data/sft_dataset_cleaned_cta.jsonl`。(2025.8.31)
3. 构造Benchmark：使用**LLM as a Jugde**，针对三种类型的侧重点构造prompt，位于`judge/judge_prompts.py`。使用大模型，对三种模型在验证集上的输出进行打分。(2025.8.30)
4. 构造奖励模型所需数据：正样本沿用为sft构造的数据。负样本使用50%“削弱文案”（使用弱prompt+弱模型生成方向接近但质量不高的文案）+30%“夸张文案”（故意添加夸大言辞的语料，违背品牌原则）+20%“添加错误”（添加1-2个不实信息）来构造。通过构造这样的负样本，可以让奖励模型对文案文笔不够好、违背品牌初衷和错误的信息进行惩罚。具体的prompts位于`dataset_generate/rm_gen_rej_prompts_exaggerated.py`, `dataset_generate/rm_gen_rej_prompts_fake.py`, `dataset_generate/rm_gen_rej_prompts_weak.py`，脚本为`generate_rm_datasets.py` (2025.8.30)
   由于原始sft_dataset又清洗了（添加了CTA），又将新内容更新到`rm_dataset_updated.csv`（添加CTA后的内容）(2025.8.31)
5. 转换为最终数据格式：从`data/rm_dataset_final.jsonl`转换成`data/sft_dataset_final.jsonl`，换成了hugging face trl库支持的格式(2025.9.1)；
6. SFT训练：采用LoRA，训练模型脚本`sft_trainer.py`，LoRA Adapter合并脚本`merge_adapter.py`，测试验证脚本`sft_tester.py`。(2025.9.1)

2025.9.1 本地测试版(0.5B模型)SFT结果跑出来了。其中golden是我们预先准备的高质量数据，在这里作为参考
```
=== 评测统计报告 ===
总评测数据: 170 条

按内容类型统计:
                           best_model  golden_avg_score  finetuned_avg_score  base_avg_score
content_type
ecommerce_long_form                19              5.00                 3.21            2.51
paid_ad_bab                        19              4.61                 2.54            3.16
paid_ad_cta                        19              4.51                 2.96            3.75
paid_ad_fab                        19              4.33                 3.02            4.05
paid_ad_pas                        19              4.77                 2.47            3.89
social_media_educational           19              4.91                 3.04            1.91
social_media_myth_busting          18              4.98                 2.81            2.07
social_media_review                19              4.98                 3.23            2.32
social_media_storytelling          19              4.98                 2.98            2.14

最佳模型统计:
  A: 145 次 (85.3%)
  C: 23 次 (13.5%)
  B: 2 次 (1.2%)

整体平均分:
  Golden (标准答案): 4.79
  Finetuned (微调模型): 2.92
  Base (基础模型): 2.87
```

问题：微调完模型的social_media类和ecommence类都比base model强，但paid_ad都弱。

观察发现在paid_ad上，我们预先准备的黄金数据得分也稍微低了一点，甚至有的和0.5B的base model产出的非常接近。但观察发现，其实二者天差地别，例如：

golden data: 
```
你的皮肤是否因氧化而暗沉？原素方程绿茶抗氧面膜，科学配方精简有效。绿茶提取物+麦角硫因协同抗氧化，从源头改善熬夜脸，温和提亮肤色。点击立即体验科学护肤的力量。
```

base model: 
```
洞见肌肤真谛，天然守护新世代】—— 选择我们的“原素方程”品牌，您将开启一段全新的护肤旅程！在这款“绿茶抗氧面膜”中，我们为您精心挑选了三重守护魔法：强效抗氧化、改善熬夜脸，以及快速提亮肌肤。

【核心原料】
- 绿茶提取物：富含丰富的抗氧化成分，能够帮助抵抗环境中的自由基损伤。
- 麦角硫因：有效促进胶原蛋白生成，提升皮肤弹性和光泽度。
- 维生素E：强大的抗氧化剂，能对抗自由基，让肌肤焕发自然光彩。
- 透明质酸：深层补水保湿，滋润干燥敏感性肌肤。

【多重功效】
1. 强效抗氧化：绿茶和麦角硫因共同作用，不仅增强肌肤对自由基的抵御能力，还能显著减少细纹和皱纹的产生。
2. 改善熬夜脸：含有维生素E和麦角硫因的配方，可促进皮脂腺分泌，加速细胞更新，修复受损的皮肤屏障，使肌肤恢复光泽。
3. 快速提亮：使用后肌肤会逐渐回弹，提亮肤色，展现出更加健康、年轻、活力充沛的外观。

【独特优势】
我们的“绿茶抗氧面膜”不同于传统护肤品，它采用的是天然植物精华，没有添加任何化学添加剂。因此，它对人体无害，适合所有肤质，特别适合肤色暗沉者。

【行动号召】
立即行动，加入我们的绿色护肤行列，让肌肤成为您的首选，享受更健康的美丽之旅！

【链接链接】
如果您还在等待或渴望一个安静、舒适的清晨，那么现在加入“原素方程”的大家庭吧！我们的“绿茶抗氧面膜”将为您提供前所未有的健康与活力。

---

这是一条精心设计的产品广告文案，旨在强调其产品的多重功效和独特的理念。通过引用关键元素并突出其独特的配方和护肤特点，吸引目标消费者进行购买行动。
```

而评测模型认为base model更好。考虑是不是评测标准定的不好。尝试优化了一下paid_ad相关prompts，最佳模型是A的情况更多了，更合理了

第二版结果：
```
=== 评测统计报告 ===

总评测数据: 170 条



按内容类型统计:

                           best_model  golden_avg_score  finetuned_avg_score  base_avg_score

content_type

ecommerce_long_form                19              5.00                 3.19            2.44

paid_ad_bab                        19              4.83                 2.53            3.39

paid_ad_cta                        19              4.71                 3.01            3.78

paid_ad_fab                        19              4.68                 3.12            3.61

paid_ad_pas                        19              4.87                 2.47            3.72

social_media_educational           19              4.91                 3.07            2.12

social_media_myth_busting          18              5.00                 2.76            2.19

social_media_review                19              4.98                 3.19            2.19

social_media_storytelling          19              4.98                 2.98            2.07



最佳模型统计:

  A: 162 次 (95.3%)

  C: 6 次 (3.5%)

  B: 2 次 (1.2%)



整体平均分:

  Golden (标准答案): 4.88

  Finetuned (微调模型): 2.93

  Base (基础模型): 2.84
```

